<!-- partials/pilot.html -->
<main id="page-pilot" class="page" aria-label="Virtual Pilot">
  <section class="section">
    <div class="wrap">

      <!-- Title -->
      <div style="max-width: 980px; margin: 0 auto 18px;">
        <h2 style="margin:0; font-weight:500; color:#000;">Virtual Pilot</h2>
        <p class="lede" style="margin-top:10px; color:#000;">
          Model contract &amp; validation scope
        </p>
      </div>

      <!-- Diagram card (flat, sharp, faint grey background; NO border; NO shadow) -->
      <div style="max-width: 980px; margin: 0 auto;">
        <div style="background:#f3f3f3; border:0; border-radius:0; padding:18px;">

          <svg viewBox="0 0 1200 320" width="100%" height="auto" role="img"
               aria-label="Process diagram: source boundary to sink boundary through centrifugal pump and control valve with transmitters">
            <defs>
              <style>
                .t{
                  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
                  fill:#000;
                }
                .mono{
                  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
                  fill:#000;
                }
                .line{ stroke:#000; stroke-width:3; fill:none; }
                .thin{ stroke:#000; stroke-width:2; fill:none; }
                .tx{ stroke:#000; stroke-width:2; fill:#fff; }
              </style>
            </defs>

            <!-- ONE (and only) horizontal process line (BROKEN so it does NOT run under boundary boxes) -->
            <!-- Source box ends at x=250; sink box starts at x=950 -->
            <path d="M250 190 L944 190" class="line" />

            <!-- Arrow head BEFORE the sink box (so it never appears inside the box) -->
            <path d="M944 190 L952 186 L952 194 Z" fill="#000"></path>

            <!-- Centrifugal pump (flat symbol) -->
            <!-- Positioned so it doesn't crowd upstream instruments -->
            <g id="pump" transform="translate(510,120)">
              <!-- casing -->
              <circle cx="50" cy="70" r="56" class="thin"/>
              <!-- simple volute swirl -->
              <path d="M32 70
                       C32 52, 44 42, 58 42
                       C74 42, 86 55, 86 70
                       C86 92, 69 104, 52 102"
                    class="thin"/>
              <path d="M52 102 C38 100, 28 92, 28 78" class="thin"/>

              <!-- suction/discharge nozzles -->
              <rect x="-16" y="62" width="16" height="16" fill="#fff" stroke="#000" stroke-width="2"/>
              <rect x="100" y="62" width="16" height="16" fill="#fff" stroke="#000" stroke-width="2"/>

              <text x="50" y="150" text-anchor="middle" class="t" style="font-size:14px; font-weight:500;">
                CENTRIFUGAL PUMP
              </text>
            </g>

            <!-- Control valve AFTER the pump (flat control valve symbol) -->
            <g id="valve" transform="translate(800,122)">
              <!-- two triangles touching -->
              <path d="M45 68 L80 45 L80 91 Z" class="thin"/>
              <path d="M115 68 L80 45 L80 91 Z" class="thin"/>

              <!-- stem + actuator -->
              <path d="M80 45 L80 20" class="thin"/>
              <path d="M58 20 L102 20" class="thin"/>
              <path d="M58 20 C66 2, 94 2, 102 20" class="thin"/>

              <text x="80" y="150" text-anchor="middle" class="t" style="font-size:14px; font-weight:500;">
                CONTROL VALVE
              </text>
            </g>

            <!-- Source PT (tap NOT visible through boundary box) -->
            <g>
              <!-- above box -->
              <path d="M170 92 L170 150" class="thin"/>
              <!-- below box -->
              <path d="M170 236 L170 190" class="thin"/>

              <circle cx="170" cy="70" r="22" class="tx"/>
              <text x="170" y="75" text-anchor="middle" class="mono" style="font-size:13px; font-weight:600;">PT</text>
              <text x="170" y="40" text-anchor="middle" class="t" style="font-size:12px;">Source P</text>
            </g>

            <!-- Suction PT -->
            <g>
              <path d="M360 92 L360 190" class="thin"/>
              <circle cx="360" cy="70" r="22" class="tx"/>
              <text x="360" y="75" text-anchor="middle" class="mono" style="font-size:13px; font-weight:600;">PT</text>
              <text x="360" y="40" text-anchor="middle" class="t" style="font-size:12px;">Suction</text>
            </g>

            <!-- Inlet TT (spaced from suction so text never overlaps) -->
            <g>
              <path d="M450 92 L450 190" class="thin"/>
              <circle cx="450" cy="70" r="22" class="tx"/>
              <text x="450" y="75" text-anchor="middle" class="mono" style="font-size:13px; font-weight:600;">TT</text>
              <text x="450" y="40" text-anchor="middle" class="t" style="font-size:12px;">Inlet T</text>
            </g>

            <!-- Pump power kW (CONNECTED TO PUMP BODY, NOT the process line) -->
            <g>
              <path d="M560 92 L560 138" class="thin"/>
              <circle cx="560" cy="70" r="22" class="tx"/>
              <text x="560" y="75" text-anchor="middle" class="mono" style="font-size:13px; font-weight:600;">kW</text>
              <text x="560" y="40" text-anchor="middle" class="t" style="font-size:12px;">Pump power</text>
            </g>

            <!-- Discharge PT -->
            <g>
              <path d="M700 92 L700 190" class="thin"/>
              <circle cx="700" cy="70" r="22" class="tx"/>
              <text x="700" y="75" text-anchor="middle" class="mono" style="font-size:13px; font-weight:600;">PT</text>
              <text x="700" y="40" text-anchor="middle" class="t" style="font-size:12px;">Discharge</text>
            </g>

            <!-- Sink PT (tap NOT visible through boundary box) -->
            <g>
              <path d="M1030 92 L1030 150" class="thin"/>
              <path d="M1030 236 L1030 190" class="thin"/>

              <circle cx="1030" cy="70" r="22" class="tx"/>
              <text x="1030" y="75" text-anchor="middle" class="mono" style="font-size:13px; font-weight:600;">PT</text>
              <text x="1030" y="40" text-anchor="middle" class="t" style="font-size:12px;">Sink P</text>
            </g>

            <!-- SOURCE boundary box (NO BORDER; covers anything behind) -->
            <rect x="90" y="150" width="160" height="86" fill="#ffffff"/>
            <text x="170" y="184" text-anchor="middle" class="t" style="font-size:14px; font-weight:500;">SOURCE</text>
            <text x="170" y="206" text-anchor="middle" class="t" style="font-size:12px;">P boundary</text>

            <!-- SINK boundary box (NO BORDER; covers anything behind) -->
            <rect x="950" y="150" width="160" height="86" fill="#ffffff"/>
            <text x="1030" y="184" text-anchor="middle" class="t" style="font-size:14px; font-weight:500;">SINK</text>
            <text x="1030" y="206" text-anchor="middle" class="t" style="font-size:12px;">P boundary</text>

          </svg>
        </div>

        <!-- Inputs / Outputs (flat, sharp, faint grey background; NO border; NO shadow) -->
        <div style="display:flex; gap:18px; align-items:stretch; margin-top:18px; flex-wrap:wrap;">
          <div style="flex:1; min-width:320px; background:#f3f3f3; border:0; border-radius:0; padding:18px;">
            <div style="font-size:18px; letter-spacing:0.08em; color:#000; margin-bottom:10px;">
              MODEL INPUTS
            </div>
            <ul style="margin:0; padding-left:18px; color:#000; line-height:1.7;">
              <li>Suction pressure (PT)</li>
              <li>Discharge pressure (PT)</li>
              <li>Inlet temperature (TT)</li>
              <li>Pump power (kW)</li>
              <li>Valve position (frac)</li>
              <li>Sink pressure (PT)</li>
              <li>Fluid Properties</li>
            </ul>
          </div>

          <div style="flex:1; min-width:320px; background:#f3f3f3; border:0; border-radius:0; padding:18px;">
            <div style="font-size:18px; letter-spacing:0.08em; color:#000; margin-bottom:10px;">
              MODEL OUTPUTS
            </div>
            <ul style="margin:0; padding-left:18px; color:#000; line-height:1.7;">
              <li>Flow rate</li>
              <li>Degradation probability</li>
              <li>Additional inferred operating metrics (configurable)</li>
            </ul>
          </div>
        </div>

        <!-- =========================================================
             RESULTS VIEWER (Option B: interactive hero + static plots)
             ========================================================= -->
        <div style="margin-top:22px; padding:18px;">
          <div style="display:flex; align-items:flex-end; justify-content:space-between; gap:14px; flex-wrap:wrap;">
            <div>
              <h2 style="margin:0; font-weight:500; color:#000;">Pilot results</h2>
              <p class="lede" style="margin:8px 0 0; color:#000; max-width:780px;">
                Compare ML predictions against the virtual plant across the operating envelope. Toggle scenarios to view baseline behavior and staged hydraulic wear.
              </p>
            </div>

            <!-- Scenario toggle -->
            <div style="display:flex; gap:10px; align-items:center;">
              <button id="pilotBtnLow" type="button" class="pilotToggleBtn pilotToggleBtnActive">Low wear</button>
              <button id="pilotBtnHigh" type="button" class="pilotToggleBtn">Staged wear</button>
            </div>
          </div>

          <!-- KPI row -->
          <div id="pilotKpiRow" style="display:grid; grid-template-columns: repeat(4, minmax(180px, 1fr)); gap:12px; margin-top:16px;">
            <div class="pilotKpi">
              <div class="pilotKpiLabel">MAPE (flow)</div>
              <div class="pilotKpiValue" id="kpi_mape">—</div>
            </div>
            <div class="pilotKpi">
              <div class="pilotKpiLabel">P95 error (flow)</div>
              <div class="pilotKpiValue" id="kpi_p95err">—</div>
            </div>
            <div class="pilotKpi">
              <div class="pilotKpiLabel">Mean wear</div>
              <div class="pilotKpiValue" id="kpi_wearmean">—</div>
            </div>
            <div class="pilotKpi">
              <div class="pilotKpiLabel">Wear &gt; 5%</div>
              <div class="pilotKpiValue" id="kpi_wearover">—</div>
            </div>
          </div>

          <!-- Hero + summary grid -->
          <div style="display:grid; grid-template-columns: 1.6fr 1fr; gap:14px; margin-top:14px; align-items:stretch;">
            <!-- Hero interactive chart -->
            <div class="pilotPanel">
              <div class="pilotPanelHeader">
                <div class="pilotPanelTitle">Machine Leanring Infernecer Flow Performance </div>
              </div>

              <div class="pilotIframeWrap">
                <iframe
                  id="pilotHeroFrame"
                  title="Pilot results interactive parity plot"
                  src="assets/results/low_deg/hero.html"
                  loading="lazy"
                  style="width:100%; height:100%; border:0;"
                ></iframe>
              </div>
            </div>

            <!-- Summary plots -->
            <div class="pilotPanel">
              <div class="pilotPanelHeader">
                <div class="pilotPanelTitle">Distributions</div>
                <div class="pilotPanelHint">Click to enlarge</div>
              </div>

              <div style="display:grid; grid-template-columns: 1fr; gap:10px;">
                <button type="button" class="pilotThumbBtn" data-zoom-src="assets/results/low_deg/error_hist.svg" data-zoom-title="Flow absolute error (%)">
                  <img id="pilotErrImg" src="assets/results/low_deg/error_hist.svg" alt="Flow absolute error distribution" class="pilotThumbImg">
                </button>

                <button type="button" class="pilotThumbBtn" data-zoom-src="assets/results/low_deg/wear_hist.svg" data-zoom-title="Predicted wear (%)">
                  <img id="pilotWearImg" src="assets/results/low_deg/wear_hist.svg" alt="Predicted wear distribution" class="pilotThumbImg">
                </button>
              </div>
            </div>
          </div>
        </div>

      </div>

      <!-- Modal (click-to-zoom for plots) -->
      <div id="pilotModal" class="pilotModal" aria-hidden="true">
        <div class="pilotModalBackdrop" id="pilotModalBackdrop"></div>
        <div class="pilotModalCard" role="dialog" aria-modal="true" aria-label="Plot preview">
          <div class="pilotModalTop">
            <div id="pilotModalTitle" class="pilotModalTitle">Plot</div>
            <button id="pilotModalClose" type="button" class="pilotModalClose" aria-label="Close">✕</button>
          </div>
          <div class="pilotModalBody">
            <img id="pilotModalImg" src="" alt="Plot preview" style="width:100%; height:auto; display:block;">
          </div>
        </div>
      </div>

      <!-- Inline styles (scoped to this page) -->
      <style>
        .pilotToggleBtn{
          appearance: none;
          border: 0;
          background: #fff;
          color: #000;
          padding: 10px 14px;
          font: inherit;
          border-radius: 0px;
          cursor: pointer;
        }
        .pilotToggleBtn:hover{ border-color: rgba(0,0,0,0.35); }
        .pilotToggleBtnActive{
          background:#215b75;
          color:#fff;
          border-color:#000;
        }

        .pilotKpi{
          background:#fff;
          border: 1px solid rgba(0,0,0,0.08);
          padding: 12px 12px;
        }
        .pilotKpiLabel{
          font-size: 12px;
          letter-spacing: 0.08em;
          text-transform: uppercase;
          color:#000;
          opacity:0.7;
        }
        .pilotKpiValue{
          margin-top: 6px;
          font-size: 22px;
          font-weight: 500;
          color:#000;
        }

        .pilotPanel{
          background:#fff;
          border: 1px solid rgba(0,0,0,0.08);
          padding: 12px;
          display:flex;
          flex-direction:column;
          min-height: 420px;
        }
        .pilotPanelHeader{
          display:flex;
          align-items:baseline;
          justify-content:space-between;
          gap:10px;
          margin-bottom: 10px;
        }
        .pilotPanelTitle{
          font-size: 14px;
          letter-spacing: 0.08em;
          text-transform: uppercase;
          color:#000;
          opacity:0.85;
        }
        .pilotPanelHint{
          font-size: 12px;
          color:#000;
          opacity:0.55;
          white-space: nowrap;
        }

        .pilotIframeWrap{
          flex:1;
          min-height: 360px;
        }

        .pilotThumbBtn{
          border:0;
          padding:0;
          background:transparent;
          cursor:pointer;
          text-align:left;
        }
        .pilotThumbImg{
          width:100%;
          height:auto;
          display:block;
          border: 1px solid rgba(0,0,0,0.08);
          background:#fff;
        }

        /* modal */
        .pilotModal{ display:none; }
        .pilotModalOpen{ display:block; position:fixed; inset:0; z-index:9999; }
        .pilotModalBackdrop{ position:absolute; inset:0; background:rgba(0,0,0,0.55); }
        .pilotModalCard{
          position:relative;
          width:min(980px, calc(100% - 28px));
          margin: 40px auto;
          background:#fff;
          border-radius: 12px;
          overflow:hidden;
          border: 1px solid rgba(0,0,0,0.10);
        }
        .pilotModalTop{
          display:flex;
          justify-content:space-between;
          align-items:center;
          padding: 12px 14px;
          border-bottom: 1px solid rgba(0,0,0,0.08);
        }
        .pilotModalTitle{
          font-size: 14px;
          letter-spacing: 0.08em;
          text-transform: uppercase;
          color:#000;
          opacity:0.85;
        }
        .pilotModalClose{
          appearance:none;
          border: 1px solid rgba(0,0,0,0.18);
          background:#fff;
          border-radius:10px;
          padding: 6px 10px;
          cursor:pointer;
        }
        .pilotModalBody{ padding: 14px; }

        @media (max-width: 980px){
          #pilotKpiRow{ grid-template-columns: repeat(2, minmax(160px, 1fr)) !important; }
          .pilotPanel{ min-height: 380px; }
          .pilotPanelHint{ white-space: normal; }
        }
        @media (max-width: 860px){
          /* stack hero + summary on small screens */
          .pilotPanel{ min-height: 320px; }
          .pilotPanelHint{ display:none; }
          .pilotIframeWrap{ min-height: 320px; }
          .pilotPanelHeader{ margin-bottom: 8px; }
          /* override the 2-col grid inline: easier using JS? keep simple by wrapping */
          /* (works because container is a grid with inline style; on small screens it's okay if it wraps visually) */
        }
      </style>
    </div>
  </section>
</main>
