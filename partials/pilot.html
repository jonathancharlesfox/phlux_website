<!-- partials/pilot.html -->
<main id="page-pilot" class="page" aria-label="Virtual Pilot">
  <section class="section">
    <div class="wrap">

      <!-- Title -->
      <div style="max-width: 980px; margin: 0 auto 18px;">
        <h2 style="margin:0; font-weight:500; color:#000;">Virtual Pilot</h2>
        <p class="lede" style="margin-top:10px; color:#000;">
          Model contract &amp; validation scope
        </p>
      </div>

      <!-- Diagram card (flat, sharp, faint grey background; NO border; NO shadow) -->
      <div style="max-width: 980px; margin: 0 auto;">
        <div style="background:#f3f3f3; border:0; border-radius:0; padding:18px;">

          <svg viewBox="0 0 1200 320" width="100%" height="auto" role="img"
               aria-label="Process diagram: source boundary to sink boundary through centrifugal pump and control valve with transmitters">
            <defs>
              <style>
                .t{
                  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
                  fill:#000;
                }
                .mono{
                  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
                  fill:#000;
                }
                .line{ stroke:#000; stroke-width:3; fill:none; }
                .thin{ stroke:#000; stroke-width:2; fill:none; }
                .tx{ stroke:#000; stroke-width:2; fill:#fff; }
              </style>
            </defs>

            <!-- ONE (and only) horizontal process line (BROKEN so it does NOT run under boundary boxes) -->
            <!-- Source box ends at x=250; sink box starts at x=950 -->
            <path d="M250 190 L944 190" class="line" />

            <!-- Arrow head BEFORE the sink box (so it never appears inside the box) -->
            <path d="M944 190 L952 186 L952 194 Z" fill="#000"></path>

            <!-- Centrifugal pump (flat symbol) -->
            <!-- Positioned so it doesn't crowd upstream instruments -->
            <g id="pump" transform="translate(510,120)">
              <!-- casing -->
              <circle cx="50" cy="70" r="56" class="thin"/>
              <!-- simple volute swirl -->
              <path d="M32 70
                       C32 52, 44 42, 58 42
                       C74 42, 86 55, 86 70
                       C86 92, 69 104, 52 102"
                    class="thin"/>
              <path d="M52 102 C38 100, 28 92, 28 78" class="thin"/>

              <!-- suction/discharge nozzles -->
              <rect x="-16" y="62" width="16" height="16" fill="#fff" stroke="#000" stroke-width="2"/>
              <rect x="100" y="62" width="16" height="16" fill="#fff" stroke="#000" stroke-width="2"/>

              <text x="50" y="150" text-anchor="middle" class="t" style="font-size:14px; font-weight:500;">
                CENTRIFUGAL PUMP
              </text>
            </g>

            <!-- Control valve AFTER the pump (flat control valve symbol) -->
            <g id="valve" transform="translate(800,122)">
              <!-- two triangles touching -->
              <path d="M45 68 L80 45 L80 91 Z" class="thin"/>
              <path d="M115 68 L80 45 L80 91 Z" class="thin"/>

              <!-- stem + actuator -->
              <path d="M80 45 L80 20" class="thin"/>
              <path d="M58 20 L102 20" class="thin"/>
              <path d="M58 20 C66 2, 94 2, 102 20" class="thin"/>

              <text x="80" y="150" text-anchor="middle" class="t" style="font-size:14px; font-weight:500;">
                CONTROL VALVE
              </text>
            </g>

            <!-- Source PT (tap NOT visible through boundary box) -->
            <g>
              <!-- above box -->
              <path d="M170 92 L170 150" class="thin"/>
              <!-- below box -->
              <path d="M170 236 L170 190" class="thin"/>

              <circle cx="170" cy="70" r="22" class="tx"/>
              <text x="170" y="75" text-anchor="middle" class="mono" style="font-size:13px; font-weight:600;">PT</text>
              <text x="170" y="40" text-anchor="middle" class="t" style="font-size:12px;">Source P</text>
            </g>

            <!-- Suction PT -->
            <g>
              <path d="M360 92 L360 190" class="thin"/>
              <circle cx="360" cy="70" r="22" class="tx"/>
              <text x="360" y="75" text-anchor="middle" class="mono" style="font-size:13px; font-weight:600;">PT</text>
              <text x="360" y="40" text-anchor="middle" class="t" style="font-size:12px;">Suction</text>
            </g>

            <!-- Inlet TT (spaced from suction so text never overlaps) -->
            <g>
              <path d="M450 92 L450 190" class="thin"/>
              <circle cx="450" cy="70" r="22" class="tx"/>
              <text x="450" y="75" text-anchor="middle" class="mono" style="font-size:13px; font-weight:600;">TT</text>
              <text x="450" y="40" text-anchor="middle" class="t" style="font-size:12px;">Inlet T</text>
            </g>

            <!-- Pump power kW (CONNECTED TO PUMP BODY, NOT the process line) -->
            <g>
              <path d="M560 92 L560 138" class="thin"/>
              <circle cx="560" cy="70" r="22" class="tx"/>
              <text x="560" y="75" text-anchor="middle" class="mono" style="font-size:13px; font-weight:600;">kW</text>
              <text x="560" y="40" text-anchor="middle" class="t" style="font-size:12px;">Pump power</text>
            </g>

            <!-- Discharge PT -->
            <g>
              <path d="M700 92 L700 190" class="thin"/>
              <circle cx="700" cy="70" r="22" class="tx"/>
              <text x="700" y="75" text-anchor="middle" class="mono" style="font-size:13px; font-weight:600;">PT</text>
              <text x="700" y="40" text-anchor="middle" class="t" style="font-size:12px;">Discharge</text>
            </g>

            <!-- Sink PT (tap NOT visible through boundary box) -->
            <g>
              <path d="M1030 92 L1030 150" class="thin"/>
              <path d="M1030 236 L1030 190" class="thin"/>

              <circle cx="1030" cy="70" r="22" class="tx"/>
              <text x="1030" y="75" text-anchor="middle" class="mono" style="font-size:13px; font-weight:600;">PT</text>
              <text x="1030" y="40" text-anchor="middle" class="t" style="font-size:12px;">Sink P</text>
            </g>

            <!-- SOURCE boundary box (NO BORDER; covers anything behind) -->
            <rect x="90" y="150" width="160" height="86" fill="#ffffff"/>
            <text x="170" y="184" text-anchor="middle" class="t" style="font-size:14px; font-weight:500;">SOURCE</text>
            <text x="170" y="206" text-anchor="middle" class="t" style="font-size:12px;">P boundary</text>

            <!-- SINK boundary box (NO BORDER; covers anything behind) -->
            <rect x="950" y="150" width="160" height="86" fill="#ffffff"/>
            <text x="1030" y="184" text-anchor="middle" class="t" style="font-size:14px; font-weight:500;">SINK</text>
            <text x="1030" y="206" text-anchor="middle" class="t" style="font-size:12px;">P boundary</text>

          </svg>
        </div>

        <!-- =========================
             Model Interface Diagram
             (replaces old INPUT / OUTPUT boxes)
             ========================= -->
        <div style="margin-top:22px; text-align:center;">
          <img
            src="assets/model_inputs_outputs.png"
            alt="Model inputs and outputs"
            style="
              max-width:100%;
              height:auto;
              opacity:0.95;
            "
          />
        </div>

        <!-- =========================================================
     FLOW PREDICTION ACCURACY (final results)
     - Dots are colored by predicted wear (0–15%)
     - Uses final flow output (ml_flow_corrected__m3_h)
     ========================================================= -->
<div class="pilotAccuracyShell">
  <div class="pilotAccuracyHeader">
    <div>
      <h2 style="margin:0; font-weight:600; color:#000;">Flow Prediction Accuracy</h2>
      <p class="lede" style="margin:10px 0 0; color:#000; max-width:860px;">
        Measured vs estimated flow across the operating envelope. Point color indicates predicted wear level.
      </p>
    </div>
  </div>

  <div class="pilotAccuracyGrid">
    <!-- LOW WEAR -->
    <div class="pilotPlotCard">
      <div class="pilotPlotBadge pilotPlotBadgeLow">LOW WEAR CASE</div>
      <div class="pilotPlotInner">
        <canvas id="pilotCanvasLow" class="pilotPlotCanvas" aria-label="Low wear parity scatter"></canvas>
      </div>
    </div>

    <!-- HIGH WEAR -->
    <div class="pilotPlotCard">
      <div class="pilotPlotBadge pilotPlotBadgeHigh">HIGH WEAR CASE</div>
      <div class="pilotPlotInner">
        <canvas id="pilotCanvasHigh" class="pilotPlotCanvas" aria-label="High wear parity scatter"></canvas>
      </div>
    </div>
  </div>

  <!-- Shared legend (below both plots) -->
  <div class="pilotLegendRow" aria-label="Wear levels legend">
    <div class="pilotLegendLabel">Wear levels</div>
    <div class="pilotLegendBarWrap">
      <div class="pilotLegendBar"></div>
      <div class="pilotLegendTicks">
        <span>0%</span>
        <span>5%</span>
        <span>10%</span>
        <span>15%</span>
      </div>
    </div>
    <div class="pilotLegendCaps">
      <span class="pilotLegendCap">0%</span>
      <span class="pilotLegendCap">15%</span>
    </div>
  </div>

  <!-- KPIs -->
  <div class="pilotKpiGrid">
    <div class="pilotKpiBlock">
      <div class="pilotKpiBlockTitle">LOW WEAR CASE</div>
      <div class="pilotKpiRow2">
        <div class="pilotKpiTile">
          <div class="pilotKpiTileLabel">Wear average</div>
          <div class="pilotKpiTileValue" id="kpi_low_wear_mean">—</div>
          <div class="pilotKpiTileSub">Average wear fraction</div>
        </div>
        <div class="pilotKpiTile">
          <div class="pilotKpiTileLabel">P95 flow error</div>
          <div class="pilotKpiTileValue" id="kpi_low_flow_p95">—</div>
          <div class="pilotKpiTileSub">95th percentile error</div>
        </div>
      </div>
    </div>

    <div class="pilotKpiBlock">
      <div class="pilotKpiBlockTitle">HIGH WEAR CASE</div>
      <div class="pilotKpiRow2">
        <div class="pilotKpiTile pilotKpiTileWarm">
          <div class="pilotKpiTileLabel">Wear average</div>
          <div class="pilotKpiTileValue" id="kpi_high_wear_mean">—</div>
          <div class="pilotKpiTileSub">Average wear fraction</div>
        </div>
        <div class="pilotKpiTile pilotKpiTileHot">
          <div class="pilotKpiTileLabel">P95 flow error</div>
          <div class="pilotKpiTileValue" id="kpi_high_flow_p95">—</div>
          <div class="pilotKpiTileSub">95th percentile error</div>
        </div>
      </div>
    </div>
  </div>

  <div class="pilotFootnote">
    Perfect prediction is the dashed line (linear, zero error). Colors indicate predicted wear (clamped to 0–15%).
  </div>
</div>

      </div>

      <!-- Modal (unchanged) -->
      <div id="pilotModal" class="pilotModal" aria-hidden="true">
        <div class="pilotModalBackdrop" id="pilotModalBackdrop"></div>
        <div class="pilotModalCard" role="dialog" aria-modal="true" aria-label="Plot preview">
          <div class="pilotModalTop">
            <div id="pilotModalTitle" class="pilotModalTitle">Plot</div>
            <button id="pilotModalClose" type="button" class="pilotModalClose" aria-label="Close">✕</button>
          </div>
          <div class="pilotModalBody">
            <img id="pilotModalImg" src="" alt="Plot preview" style="width:100%; height:auto; display:block;">
          </div>
        </div>
      </div>

    </div>
  </section>
</main>
